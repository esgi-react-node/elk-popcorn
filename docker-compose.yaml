version: "3"

services:
    node:
        image: node
        user: node
        working_dir: /home/node
        tty: true
        stdin_open: true
        ports:
            - 8080:8080
            - 8081:8081
        env_file:
            - .env
        volumes:
            - .:/home/node
        
    elasticsearch:
        restart: always
        image: docker.elastic.co/elasticsearch/elasticsearch:7.7.0
        environment:
            - "discovery.type=single-node"
        ports:
            - 9200:9200
            - 9300:9300
        volumes:
            - ./elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml

    kibana:
        restart: always
        depends_on:
            - elasticsearch
        image: docker.elastic.co/kibana/kibana:7.7.0
        ports:
            - 5601:5601

    nginx:
        restart: always
        image: nginx:1.19.0
        ports:
            - 80:80
        volumes:
            - ./nginx/default.conf:/etc/nginx/conf.d/default.conf
            - ./public:/usr/share/nginx/html
